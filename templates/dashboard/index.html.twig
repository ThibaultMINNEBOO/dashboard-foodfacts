{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block body %}
    <div class="min-h-screen bg-muted/20">
        <header class="sticky top-0 z-10 border-b bg-background/80 backdrop-blur">
            <div class="mx-auto flex h-16 w-full max-w-screen-2xl items-center justify-between px-6">
                <div class="flex items-center gap-3">
                    <div class="flex size-9 items-center justify-center rounded-lg bg-primary text-primary-foreground">
                        <twig:ux:icon name="lucide:layout-dashboard" class="size-5" />
                    </div>
                    <div class="leading-tight">
                        <div class="text-sm font-semibold">FoodDash</div>
                        <div class="text-xs text-muted-foreground">Dashboard</div>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <div class="hidden text-sm font-medium text-foreground sm:block">
                        {{ app.user ? app.user.userIdentifier : 'Utilisateur' }}
                    </div>
                    <div class="size-9 rounded-full bg-muted"></div>
                </div>
            </div>
        </header>

        <main class="mx-auto w-full max-w-screen-2xl px-6 py-8">
            <div class="mb-6 flex items-center justify-between gap-4">
                <div>
                    <h1 class="text-2xl font-semibold tracking-tight">Widgets</h1>
                    <p class="text-sm text-muted-foreground">Ajoute, configure et réorganise tes widgets.</p>
                </div>

                <a href="{{ path('app_widget_create') }}" class="inline-flex items-center gap-2 rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:opacity-95">
                    <twig:ux:icon name="lucide:plus" class="size-4" />
                    Ajouter un widget
                </a>
            </div>

            {% if widgets is empty %}
                <div class="mt-10">
                    <twig:Card class="mx-auto w-full max-w-3xl">
                        <div class="p-10 sm:p-14 text-center">
                            <div class="mx-auto mb-6 flex size-14 items-center justify-center rounded-2xl bg-muted">
                                <twig:ux:icon name="lucide:layout-template" class="size-7 text-muted-foreground" />
                            </div>

                            <h2 class="text-2xl font-semibold tracking-tight">Ton dashboard est vide</h2>
                            <p class="mt-3 text-base leading-relaxed text-muted-foreground max-w-xl mx-auto">
                                Ajoute ton premier widget pour commencer. Tu pourras ensuite les déplacer par glisser-déposer.
                            </p>

                            <div class="mt-8 flex flex-col sm:flex-row items-stretch justify-center gap-3">
                                <a href="{{ path('app_widget_create') }}" class="inline-flex items-center justify-center rounded-md bg-primary px-6 py-3 text-sm font-medium text-primary-foreground hover:opacity-95 w-full sm:w-auto">
                                    <twig:ux:icon name="lucide:plus" class="size-4" />
                                    Ajouter un widget
                                </a>
                            </div>
                        </div>
                    </twig:Card>
                </div>
            {% else %}
                <meta name="csrf-token" content="{{ csrf_token('reorder-widgets') }}">
                <div class="grid gap-5 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4" data-controller="dashboard-sortable" data-dashboard-sortable-url-value="{{ path('app_widget_reorder') }}">
                    {% for widget in widgets %}
                        <div class="group relative cursor-grab active:cursor-grabbing" data-id="{{ widget.id }}">
                            <twig:Card class="h-full transition-all duration-200 ease-in-out transform-gpu will-change-transform group-hover:-translate-y-1 group-hover:shadow-lg">
                                <div class="flex items-center justify-between border-b px-4 py-3">
                                    <div class="min-w-0">
                                        <div class="truncate text-sm font-semibold">
                                            {{ widget.title ?? 'Widget' }}
                                        </div>
                                    </div>
                                    <form method="post" action="{{ path('app_widget_delete', {id: widget.id}) }}">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete-widget-' ~ widget.id) }}">
                                        <twig:Button variant="ghost" size="sm">
                                            <twig:ux:icon name="lucide:trash-2" class="size-4" />
                                        </twig:Button>
                                    </form>
                                </div>
                                <div class="p-4">
                                    <div data-controller="widget-loader" data-widget-loader-url-value="{{ path('app_widget_resolve', {id: widget.id}) }}" class="widget-content"></div>
                                </div>
                            </twig:Card>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </main>
    </div>

{% endblock %}
